<script type="text/javascript">
    /* global RED */
    RED.nodes.registerType('Alpaca', {
        category: 'alpaca',
        color: '#EEEEEE',
        defaults: {
            name: { value: "" },
            topic: { value: "msgTopic" },
            auth: { value: "", type: "alpaca-config" }
        },
        inputs: 1,
        outputs: 1,
        icon: "alpaca.svg",
        label: function() {
            if(this.topic=="msgTopic"){
                return this.name || "Alpaca";
            }else{
                return this.name || this.topic;
            }
        }
    });
    RED.nodes.registerType('Alpaca-Websocket', {
        category: 'alpaca',
        color: '#EEEEEE',
        defaults: {
            name: { value: "" },
            auth: { value: "", type: "alpaca-config" }
        },
        inputs: 0,
        outputs: 1,
        icon: "alpaca.svg",
        label: function() {
            return this.name || "Alpaca Websocket";
        }
    });
    

</script>

<!------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------->
<style type="text/css">
    .copy-button{
        position: relative;
        right: 0px;
        top: 0px;
        float: right;
        box-sizing: border-box;
        background: white;
        border: 1px solid #aa6767;
        text-shadow: none;
        font-size: 12px;
        color: #666 !important;
        padding: 6px 10px;
        border-top-right-radius: 3px;
        border-bottom-left-radius: 3px;
        vertical-align: middle;
        cursor: pointer;
    }
</style>
<script type="text/x-red" data-template-name="Alpaca">
    <!-----------------API KEYS--------------------->
    <div class="form-row">
        <label for="node-input-auth"><i class="fa fa-key"></i> Auth</label>
        <input type="text" id="node-input-auth" placeholder="API Keys">
    </div>
    <!-----------------NAME--------------------->
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <!-----------------FUNCTION--------------------->
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-function"></i> Function</label>
        <select id="node-input-topic" placeholder="Function">
            <option value=	"msgTopic"	>	Use msg.Topic	</option>
            <option value = "getAccount"> Get Account </option>
            <option value = "getAccountConfigurations"> Get Account Configurations </option>
            <option value = "updateAccountConfigurations"> Update Account Configurations </option>
            <option value = "getAccountActivities"> Get Account Activities </option>
            <option value = "getPortfolioHistory"> Get Portfolio History </option>
            <option value = "createOrder"> Create Order </option>
            <option value = "getOrders"> Get Orders </option>
            <option value = "getOrder"> Get Order </option>
            <option value = "getOrderByClientOrderId"> Get Order By Client Order Id </option>
            <option value = "replaceOrder"> Replace Order </option>
            <option value = "cancelOrder"> Cancel Order </option>
            <option value = "cancelAllOrders"> Cancel All Orders </option>
            <option value = "getPosition"> Get Position </option>
            <option value = "getPositions"> Get Positions </option>
            <option value = "closePosition"> Close Position </option>
            <option value = "closeAllPositions"> Close All Positions </option>
            <option value = "getAssets"> Get Assets </option>
            <option value = "getAsset"> Get Asset </option>
            <option value = "getCalendar"> Get Calendar </option>
            <option value = "getWatchlists"> Get Watchlists </option>
            <option value = "getWatchlist"> Get Watchlist </option>
            <option value = "addWatchlist"> Add Watchlist </option>
            <option value = "addToWatchlist"> Add To Watchlist </option>
            <option value = "updateWatchlist"> Update Watchlist </option>
            <option value = "deleteWatchlist"> Delete Watchlist </option>
            <option value = "deleteFromWatchlist"> Delete From Watchlist </option>
        </select>
        <br />
    </div>

<div class="form-row alpaca-help" style="display:none;" data-topic="msgTopic"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">msg.topic = </span><button class="copy-button" type="button">Copy</button><span>
[
    "getAccount",
    "getAccountConfigurations",
    "updateAccountConfigurations",
    "getAccountActivities",
    "getPortfolioHistory",
    "createOrder",
    "getOrders",
    "getOrder",
    "getOrderByClientOrderId",
    "replaceOrder",
    "cancelOrder",
    "cancelAllOrders",
    "getPosition",
    "getPositions",
    "closePosition",
    "closeAllPositions",
    "getAssets",
    "getAsset",
    "getCalendar",
    "getWatchlists",
    "getWatchlist",
    "addWatchlist",
    "addToWatchlist",
    "updateWatchlist",
    "deleteWatchlist",
    "deleteFromWatchlist"
]</span></pre>
</div><!--------</alpaca-help>-------->
    <div class="form-row alpaca-help" style="display:none;" data-topic="getAccount"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}} </span>()
    => Promise&lt;Account&gt;;
<small>     ...this function takes no arguments</small></pre>
</div><!--------</alpaca-help>-------->
    <div class="form-row alpaca-help" style="display:none;" data-topic="getAccountConfigurations"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}} </span>()
    => Promise&lt;AccountConfiguration&gt;;
<small>     ...this function takes no arguments</small></pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="updateAccountConfigurations"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    "dtbp_check":"entry",
    "no_shorting":false,
    "pdt_check":"entry",
    "suspend_trade":false,
    "trade_confirm_email":"none"
}</span>
    ) => Promise&lt;AccountConfiguration&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getAccountActivities"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    activityTypes: string | string[], // Any valid activity type
    until: Date,
    after: Date,
    direction: string,
    date: Date,
    pageSize: number,
    pageToken: string
}</span>
    ) => Promise&lt;AccountActivity[]&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getPortfolioHistory"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    date_start: Date,
    date_end: Date,
    period: '1M' | '3M' | '6M' | '1A' | 'all' | 'intraday',
    timeframe: '1Min' | '5Min' | '15Min' | '1H' | '1D',
    extended_hours: Boolean
}</span>
    ) => Promise&lt;PortfolioHistory&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="createOrder"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    symbol: string, // any valid ticker symbol
    qty: number,
    side: 'buy' | 'sell',
    type: 'market' | 'limit' | 'stop' | 'stop_limit' | 'trailing_stop',
    time_in_force: 'day' | 'gtc' | 'opg' | 'ioc',
    limit_price: number, // optional,
    stop_price: number, // optional,
    client_order_id: string, // optional,
    extended_hours: boolean, // optional,
    order_class: string, // optional,
    take_profit: object, // optional,
    stop_loss: object, // optional,
    trail_price: string, // optional,
    trail_percent: string // optional,
}</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getOrders"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    status: 'open' | 'closed' | 'all',
    after: Date,
    until: Date,
    limit: number,
    direction: 'asc' | 'desc'
}</span>
    ) => Promise&lt;Order[]&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getOrder"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = uuid)
    => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getOrderByClientOrderId"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = string)
    => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="replaceOrder"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = uuid)
    => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="cancelOrder"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = uuid)
    => Promise</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="cancelAllOrders"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> ()
    => Promise
<small>     ...this function takes no arguments</small></pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getPosition"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = symbol)
    => Promise&lt;Position&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getPositions"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> ()
    => Promise&lt;Position&gt;</pre>
<small>     ...this function takes no arguments</small></pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="closePosition"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = symbol)
    => Promise</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="closeAllPositions"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> ()
    => Promise</pre>
<small>     ...this function takes no arguments</small></pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getAssets"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    status: 'active' | 'inactive',
    asset_class: string
}</span>
    ) => Promise&lt;Asset[]&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getAsset"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = symbol)
    => Promise&lt;Asset&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getCalendar"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
{
    start: Date,
    end: Date
}</span>
    ) => Promise&lt;Calendar[]&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getWatchlists"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="getWatchlist"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="addWatchlist"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="addToWatchlist"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="updateWatchlist"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="deleteWatchlist"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->
<div class="form-row alpaca-help" style="display:none;" data-topic="deleteFromWatchlist"><!--------<alpaca-help>-------->
<pre class="highlight language-javascript"><span class="f">{{topic}}</span> (msg.payload = <button class="copy-button" type="button">Copy</button><span>
!!!WIP!!!
</span>
    ) => Promise&lt;Order&gt;</pre>
</div><!--------</alpaca-help>-------->

<script type="text/javascript">
/*global $*/
    $(document).ready(function(){
        $(".copy-button").on("click", function(evt) {
            evt.preventDefault();
            var ta = document.createElement('textarea');
            ta.value = $(this).next()[0].innerText;
            ta.style.position = 'absolute';
            ta.style.left = '-3000px';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            $(this).text("Copied!");
            var self = $(this);
            setTimeout(function() {
                self.text("Copy");
            },3000);
        });
        $("#dialog-form .form-row .highlight span.f").each(function(){
            $(this).text(function(){
                return $(this).text().replace(
                    "{{topic}}",
                    $(this).parent().parent().data("topic")
                );
            });
        });
        var showHelp = function(){
            var newTopic = $("#node-input-topic").val();
            $("#dialog-form .form-row.alpaca-help").each(function(){
                var $row = $(this);
                if($row.data("topic") == newTopic){
                    $row.show();
                }else{
                    $row.hide();
                }
            });
        };
        $("#node-input-topic").on("change", showHelp);
        $("#node-input-topic").ready(showHelp);
    });
</script>
</script>

<script type="text/x-red" data-help-name="Alpaca">
    <p>Node for reacting various events such as order and account status changes</p>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload
           <span class="property-type">object</span>
       </dt>
        <h3>Details</h3>
        <p>Payload is the full response object from the API</p>
        <dt>topic
           <span class="property-type">string</span>
       </dt>
        <h3>Details</h3>
        <p>Topic is the type of event being emitted from the node</p>
</script>

<!------------------------------------------------------------------------------------->

<script type="text/x-red" data-template-name="Alpaca-Websocket">
    <div class="form-row">
        <label for="node-input-auth"><i class="fa fa-key"></i> Auth</label>
        <input type="text" id="node-input-auth" placeholder="API Keys">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/x-red" data-help-name="Alpaca-Websocket">
    <p>Node for reacting various events such as order and account status changes</p>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload
           <span class="property-type">object</span>
       </dt>
        <h3>Details</h3>
        <p>Payload is the full response object from the API</p>
        <dt>topic
           <span class="property-type">string</span>
       </dt>
        <h3>Details</h3>
        <p>Topic is the type of event being emitted from the node</p>
</script>
